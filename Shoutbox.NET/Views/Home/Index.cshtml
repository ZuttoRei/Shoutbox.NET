@{
    ViewBag.Title = "Shoutbox";
    ViewBag.Icon = "fa fa-bullhorn";
}

@Scripts.Render("~/bundles/signalr")
@Scripts.Render("/signalr/hubs")
<link href="~/Content/Chat.css" rel="stylesheet" />
<link href="~/Content/Shoutbox.css" rel="stylesheet" />
<script src="~/Scripts/jquery.timeago.js"></script>
<script src="~/Scripts/chattile.js"></script>
@*<link href="~/Content/MVP.css" rel="stylesheet" />*@

<!-- Begin tile grid -->
<div class="grid-stack">
    <!-- Begin Chat Tile-->
    <div class="grid-stack-item"
         data-gs-x="0" data-gs-y="0"
         data-gs-width="4" data-gs-height="6" data-gs-min-width="2" data-gs-min-height="4">
        
        <div class="grid-stack-item-content rabo-drop-shadow">
            <!-- Chat Container -->
            <div id="chat-window">
                <div class="chat-filler">
                    <i class="fa fa-comment-o" aria-hidden="true"></i> <br />
                    <p>Er zijn nog geen berichten geplaatst...</p>
                </div>
                <div class="message-container">
                    <input class="message-counter" type="hidden" value="0" />
                    <!-- Begin messages -->
                    <!-- End messages -->
                </div>

                <div class="textbox-wrapper">
                    <div class="input-group input-group-sm text-input">
                        <span class="input-group-addon tag-display"></span>
                        <input type="text" class="form-control" placeholder="Bericht..." aria-describedby="sizing-addon3" onkeyup="$(this).ProcessInput(event)">
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Begin MVP tile -->
    <div class="grid-stack-item" data-gs-x="4" data-gs-y="0"
         data-gs-width="3" data-gs-height="4" data-gs-min-width="1" data-gs-min-height="1">

        <div class="grid-stack-item-content rabo-drop-shadow">
            SAD
        </div>
    </div>
</div>

<script>
        var sendChatMessage;

        // Reference the auto-generated proxy for the hub.
        var chat = $.connection.chatHub;

        // Start the connection.
        $.connection.hub.start().done(function () {
            // Call the Send method on the hub.
            sendChatMessage = function (tag, text) {
                chat.server.broadcastChatMessage(tag, text)
            }
        });

        // When receiving a normal chat message
        chat.client.receiveChatMessage = function (name, division, time, tag, text) {
            $("#chat-window").AddMessage(name, division, time, tag, text, true);
        };

        // This function html-encodes messages for display in the page, prevents XSS
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }
</script>