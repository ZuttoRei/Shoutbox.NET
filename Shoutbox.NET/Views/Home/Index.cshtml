@{
    ViewBag.Title = "Shoutbox";
    ViewBag.Icon = "fa fa-bullhorn";
}

@model Shoutbox.NET.ViewModels.IndexViewModel

@Scripts.Render("~/bundles/signalr")
@Scripts.Render("/signalr/hubs")
<link href="~/Content/Chat.css" rel="stylesheet" />
<link href="~/Content/Shoutbox.css" rel="stylesheet" />

<!-- Unsorted plugins -->
<script src="~/Scripts/jquery.timeago.js"></script>
<script src="~/Scripts/jquery.timeago.nl.js"></script>
<script src="~/Scripts/jqcloud.min.js"></script>

<!-- Scripts for each individual tile type -->
<script src="~/Scripts/chattile.js"></script>
<script src="~/Scripts/tagcloud.js"></script>

<!-- Begin tile grid -->
<div class="grid-stack">
    <!-- Begin Chat Tile-->
    <div class="grid-stack-item"
         data-gs-x="0" data-gs-y="0"
         data-gs-width="4" data-gs-height="6" data-gs-min-width="2" data-gs-min-height="4">
        
        <div class="grid-stack-item-content rabo-drop-shadow">
            <!-- Chat Container -->
            <div id="chat-window">
                <div class="chat-filler">
                    <i class="fa fa-comment-o" aria-hidden="true"></i> <br />
                    <p>Er zijn nog geen berichten geplaatst...</p>
                </div>
                <div class="message-container">
                    <input class="message-counter" type="hidden" value="0" />
                    <!-- Begin messages -->
                    <!-- End messages -->
                </div>

                <div class="textbox-wrapper">
                    <div class="input-group input-group-sm text-input">
                        <span class="input-group-addon tag-display"></span>
                        <input type="text" class="form-control" placeholder="Bericht..." aria-describedby="sizing-addon3" onkeyup="$(this).ProcessInput(event)">
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Begin TagCloud tile -->
    <div class="grid-stack-item" data-gs-x="4" data-gs-y="0"
         data-gs-width="3" data-gs-height="4" data-gs-min-width="1" data-gs-min-height="1">

        <div class="grid-stack-item-content rabo-drop-shadow">
            <div id="tag-cloud">
            </div>
        </div>
    </div>
</div>

<script>
        var sendChatMessage;
        var words = [{
            text: "Lorem",
            weight: 13
        }, {
            text: "Ipsum",
            weight: 10.5
        }, {
            text: "Dolor",
            weight: 9.4
        }, {
            text: "Sit",
            weight: 8
        }, {
            text: "Amet",
            weight: 6.2
        }, {
            text: "Consectetur",
            weight: 5
        }, {
            text: "Adipiscing",
            weight: 5
        }];


        // Reference the auto-generated proxy for the hub.
        var chat = $.connection.chatHub;

        // Start the connection.
        $.connection.hub.start().done(function () {
            // Call the Send method on the hub.
            sendChatMessage = function (tag, text) {
                chat.server.broadcastChatMessage(tag, text)
            }
        });

        // When receiving a normal chat message
        chat.client.receiveChatMessage = function (name, division, time, tag, text) {

            $("#chat-window").AddMessage(name, division, time, tag, text, true);
            $('#tag-cloud').jQCloud(words, {
                width: 100,
                height: 100
            });
        };

        // This function html-encodes messages for display in the page, prevents XSS
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }

    @{
        <text>
        $("#chat-window").AddMessages(@Html.Raw(Model.SerializedMessages));
        </text>

    }

</script>